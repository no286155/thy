name: file c
# on: workflow_dispatch
on:
  schedule:
      - cron: '50 4 * * *'

jobs:
  build:
    runs-on: ubuntu-latest
    timeout-minutes: 105  # Automatically stops the job if it exceeds 10 minutes
    steps:
    # - uses: actions/checkout@v4
    
    - name: Setup stuff
      run: |
        # wget -q https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb
        # sudo dpkg -i cloudflared-linux-amd64.deb
        # Add cloudflare gpg key
        sudo mkdir -p --mode=0755 /usr/share/keyrings
        curl -fsSL https://pkg.cloudflare.com/cloudflare-main.gpg | sudo tee /usr/share/keyrings/cloudflare-main.gpg >/dev/null
        
        # Add this repo to your apt repositories
        echo 'deb [signed-by=/usr/share/keyrings/cloudflare-main.gpg] https://pkg.cloudflare.com/cloudflared any main' | sudo tee /etc/apt/sources.list.d/cloudflared.list
        
        # install cloudflared
        sudo apt-get update && sudo apt-get install cloudflared
        curl -fsSL https://code-server.dev/install.sh | sh
        sleep 3
        sudo systemctl enable --now code-server@$USER
        sleep 3
        sudo systemctl stop code-server@$USER
        sed -i "s/^password: .*/password: ${{secrets.CODE_PASSWORD}}/" ~/.config/code-server/config.yaml
        sudo systemctl start code-server@$USER
        cloudflared tunnel run --token ${{secrets.TOKEN_MOOW}} > /dev/null 2>&1 &
        cloudflared tunnel run --token ${{secrets.DEV_MOOW}} > /dev/null 2>&1 &
        sleep 2h
